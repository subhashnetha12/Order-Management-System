<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fetch GSTIN Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .card {
      margin-top: 30px;
    }
    .result-label {
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="card shadow">
    <div class="card-body">
      <h4 class="card-title mb-4">Fetch Customer Details Using GSTIN</h4>

      <div class="mb-3">
        <label for="gstin" class="form-label">Enter GSTIN Number</label>
        <input type="text" class="form-control" id="gstin" placeholder="e.g., 29ABCDE1234F2Z5">
      </div>

      <button class="btn btn-primary" onclick="fetchGSTDetails()">Fetch Details</button>

      <div id="loading" class="mt-3 text-info" style="display: none;">Loading...</div>

      <div id="result" class="mt-4" style="display: none;">
        <h5 class="mb-3">Customer Details:</h5>
        <div class="row g-3">
          <div class="col-md-6"><span class="result-label">Registered Name:</span> <span id="lgnm"></span></div>
          <div class="col-md-6"><span class="result-label">Business Name:</span> <span id="tradeNam"></span></div>
          <div class="col-md-6"><span class="result-label">Display Name:</span> <span id="displayName"></span></div>
          <div class="col-md-6"><span class="result-label">Address Line 1:</span> <span id="address1"></span></div>
          <div class="col-md-6"><span class="result-label">Address Line 2:</span> <span id="address2"></span></div>
          <div class="col-md-4"><span class="result-label">City:</span> <span id="city"></span></div>
          <div class="col-md-4"><span class="result-label">Pincode:</span> <span id="pincode"></span></div>
          <div class="col-md-4"><span class="result-label">State Code:</span> <span id="stateCode"></span></div>
          <div class="col-md-4"><span class="result-label">Country:</span> <span id="country"></span></div>
        </div>
      </div>

      <div id="error" class="mt-3 text-danger" style="display: none;"></div>
    </div>
  </div>
</div>

<script>
  function fetchGSTDetails() {
    const gstin = document.getElementById("gstin").value.trim();
    const resultBox = document.getElementById("result");
    const errorBox = document.getElementById("error");
    const loading = document.getElementById("loading");

    resultBox.style.display = "none";
    errorBox.style.display = "none";
    loading.style.display = "block";

    fetch("/gstin-details/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCookie('csrftoken')
      },
      body: JSON.stringify({ gstin: gstin })
    })
    .then(res => res.json())
    .then(data => {
      loading.style.display = "none";

      if (data.success) {
        const info = data.data;
        document.getElementById("lgnm").innerText = info["Customer Registered Name"];
        document.getElementById("tradeNam").innerText = info["Business Name"];
        document.getElementById("displayName").innerText = info["Display Name"];
        document.getElementById("address1").innerText = info["Address Line 1"];
        document.getElementById("address2").innerText = info["Address Line 2"];
        document.getElementById("city").innerText = info["City"];
        document.getElementById("pincode").innerText = info["Pincode"];
        document.getElementById("stateCode").innerText = info["State Code"];
        document.getElementById("country").innerText = info["Country"];

        resultBox.style.display = "block";
      } else {
        errorBox.innerText = data.message;
        errorBox.style.display = "block";
      }
    })
    .catch(err => {
      loading.style.display = "none";
      errorBox.innerText = "Error fetching GSTIN details.";
      errorBox.style.display = "block";
    });
  }

  // Helper to get CSRF token
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + "=")) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>

</body>
</html>